#!/usr/bin/perl
use strict;
use v5.36;
use warnings FATAL => 'all';
use utf8;
use open qw(:std :utf8);
no feature qw(indirect);
use Dotenv;
use OpenAI::API;

my $openai = OpenAI::API->new();    # uses OPENAI_API_KEY environment variable

my $res = $openai->chat(
  messages => [
    { "role" => "system",    "content" => "You are a helpful assistant." },
    { "role" => "user",      "content" => "How can I access OpenAI's APIs in Perl?" },
    { "role" => "assistant", "content" => "You can use the OpenAI::API module." },
    { "role" => "user",      "content" => "Where can I find this module?" },
  ],
  max_tokens  => 100,
  temperature => 0,
);

my $message = $res->{choices}[0]{message};    # or simply: my $message = "$res";
say $message->{content};